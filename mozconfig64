# This file specifies the build flags for Iceweasel.  You can use it by adding:
# to the top of your mozconfig file.
# PGO build (mozmake -f client.mk profiledbuild)
# PGO build (mach build -v 2>&1 | tee -i ../build_x64.log)
. $topsrcdir/browser/config/mozconfig
ac_add_options --with-app-name=Iceweasel

mk_add_options MOZ_OBJDIR=@TOPSRCDIR@/../obju64-release
mk_add_options MOZ_MAKE_FLAGS=-j4

# for 64-bit build
ac_add_options --target=x86_64-pc-mingw32
ac_add_options --host=x86_64-pc-mingw32

export LIB="/d/works/mozillabuild/clang/lib:/d/works/mozillabuild/clang/lib/clang/9.0.1/lib/windows"

# for X64
ac_add_options MOZ_PGO=1
ac_add_options --enable-optimize="-O2 -DTT_MEMUTIL"

#disable tests
ac_add_options --disable-tests
ac_add_options --disable-ipdl-tests

# diasble updater
ac_add_options --disable-updater

# disable crashreporter
ac_add_options --disable-crashreporter

# disable parental controls
ac_add_options --disable-parental-controls

# disable more modules
ac_add_options --disable-necko-wifi

# disable dbm
# ac_add_options --disable-dbm

# disable googlepad
# ac_add_options --disable-gamepad

# disable sandbox
# ac_add_options --disable-accessibility
# ac_add_options --disable-sandbox

# disable debug
ac_add_options --disable-debug
ac_add_options --disable-debug-symbols
ac_add_options --disable-maintenance-service

# Enable MOZ_ALLOW_LEGACY_EXTENSIONS
ac_add_options "MOZ_ALLOW_LEGACY_EXTENSIONS=1"

# Add-on signing is not required
MOZ_REQUIRE_SIGNING=0

# enable clang plugins
#ac_add_options --enable-clang-plugin
#ac_add_options --enable-mozsearch-plugin

# Enable jemalloc,crypto
ac_add_options --enable-rust-simd
ac_add_options --enable-jemalloc

# for iceweasel
export MOZILLA_OFFICIAL=1
ac_add_options --enable-update-channel=release
ac_add_options --with-branding=browser/branding/iceweasel

# crt dir
WIN32_REDIST_DIR=${VC_REDISTDIR%?}\\x64\\Microsoft.VC142.CRT
WIN_UCRT_REDIST_DIR=${UCRT_REDISTDIR%?}\\Redist\\ucrt\\DLLs\\x64
